<!--
  Template principal de l'application.
  
  Structure :
  - Bloc de connexion / inscription (affiché si l'utilisateur n'est pas connecté)
  - Bloc de bienvenue + bouton de déconnexion (affiché si l'utilisateur est connecté)
  - Bloc de gestion des projets : formulaire d'ajout + liste des projets
  - Messages d'erreur, de confirmation et loader
-->
<div class="app-content">
  <div class="auth-box" *ngIf="showLogin()">
    <!-- login -->
    <h2>Connexion</h2>
    <form #loginForm="ngForm" (ngSubmit)="login()">
       <input type="text" placeholder="Email" [(ngModel)]="loginEmail" name="email" required>
       <input type="password" placeholder="Mot de passe" [(ngModel)]="loginPassword" name="password" required>
       <button type="submit">Se connecter</button>
     </form>
  <hr>
   <h2>Créer un compte</h2>
   <form #registerForm="ngForm" (ngSubmit)="register()">
     <input type="text" placeholder="Username" [(ngModel)]="newUser.username" name="username" required>
     <input type="email" placeholder="Email" [(ngModel)]="newUser.email" name="email" required>
     <input type="password" placeholder="Mot de passe" [(ngModel)]="newUser.password" name="password" required>
     <button type="submit">S'enregistrer</button>
   </form>
    <!-- Message de confirmation inscription -->
    <div *ngIf="confirmation" class="confirmation-register">
      {{ confirmation }}
    </div>
  </div>
  <br>
  <div class="app-box" *ngIf="showApp()">
    <h3>Bienvenue {{ currentUser }}</h3>
    <button class="logout" (click)="logout()">Se déconnecter</button>
  </div>
  <div *ngIf="showApp()">
    <!-- contenu appli + projets -->
    <h2>Liste des projets</h2>
    <form (ngSubmit)="onSubmit()" #projectForm="ngForm">
      <label>ID : </label>
      <input type="text" name="id" [(ngModel)]="newProject.id" required>
      <br>
      <label>Description : </label>
      <input type="text" name="desc" [(ngModel)]="newProject.desc" required>
      <br>
      <button type="submit" [disabled]="projectForm.invalid">Ajouter</button>
    </form>
    <!-- Message de confirmation -->
    <div *ngIf="confirmation" class="confirmation">
      {{ confirmation }}
    </div>
    <hr>
    <!-- pour debug -->
    <!--<pre>{{ loading }} - {{ error }} - {{ items.length }}</pre>-->
    <!-- Affiché tant que la requête est en cours -->
    <div *ngIf="loading">
      Chargement en cours...
    </div>
    <!-- Message si la liste est vide -->
    <div *ngIf="!loading && items.length === 0">Aucun projet trouvé</div>

    <!-- Affiché en cas d’erreur -->
    <div *ngIf="error && !loading" style="color:red;">
      Impossible de récupérer les données.
    </div>
    <!-- Affichage de la liste seulement si items n'est pas vide -->
    <ul *ngIf="!loading && !error">
      <li *ngFor="let item of items">
        <strong>ID interne:</strong> {{ item._id }} <br>
        <strong>ID:</strong> {{ item.id }} <br>
        <strong>Description:</strong> {{ item.desc }}
      </li>
    </ul>
  </div>
</div>